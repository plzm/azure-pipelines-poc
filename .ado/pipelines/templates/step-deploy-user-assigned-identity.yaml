parameters:
- name: ResourceGroupName
  displayName: 'Resource Group to deploy to'
  type: string
- name: UaiName
  displayName: 'Resource ID that is getting the diagnostics setting'
  type: string

steps:
- task: AzureCLI@2
  displayName: 'Deploy User-Assigned Identity'
  inputs:
    azureSubscription: '$(AzureServiceConnection)'
    scriptType: pscore
    scriptLocation: inlineScript
    inlineScript: |
      $output = plzm.Azure\Deploy-UserAssignedIdentity `
        -SubscriptionID "$(AzureSubscriptionId)" `
        -Location $(AzureLocation) `
        -ResourceGroupName ${{ parameters.ResourceGroupName }} `
        -TemplateUri ($(UriPrefixArmTemplates) + "identity.user-assigned-identity.json") `
        -TenantId "$(AzureTenantId)" `
        -UAIName "${{ parameters.UaiName }}" `
        -Tags $(TagsJson)

      Write-Debug -Debug:$true -Message "$output"
